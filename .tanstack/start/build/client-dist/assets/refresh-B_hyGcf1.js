import{i as C,c as E,j as e,f as g,r as v,k as X,l as H,u as J,m as U,B as f,n as M,L as b,o as D}from"./main-CGbeZWPF.js";import{u as W}from"./useQuery-C_bI6VZF.js";import{B as Y}from"./badge-DoS3K9_r.js";import{c as Z,P as L,q as ee}from"./index-B-fB-t8l.js";function se({queryFn:s,refetchMode:t="reset",maxChunks:r}){return async i=>{const n=i.client.getQueryCache().find({queryKey:i.queryKey,exact:!0}),u=!!n&&n.state.data!==void 0;u&&t==="reset"&&n.setState({status:"pending",data:void 0,error:null,fetchStatus:"fetching"});let m=[];const d=await s(i);for await(const a of d){if(i.signal.aborted)break;(!u||t!=="replace")&&i.client.setQueryData(i.queryKey,(o=[])=>C(o,a,r)),m=C(m,a,r)}return u&&t==="replace"&&!i.signal.aborted&&i.client.setQueryData(i.queryKey,m),i.client.getQueryData(i.queryKey)}}/**
 * @license lucide-react v0.540.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],k=E("circle-check",te);/**
 * @license lucide-react v0.540.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],ae=E("circle",re);function N({className:s,...t}){return e.jsx("div",{"data-slot":"card",className:g("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",s),...t})}function y({className:s,...t}){return e.jsx("div",{"data-slot":"card-header",className:g("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",s),...t})}function _({className:s,...t}){return e.jsx("div",{"data-slot":"card-title",className:g("leading-none font-semibold",s),...t})}function z({className:s,...t}){return e.jsx("div",{"data-slot":"card-content",className:g("px-6",s),...t})}var S="Progress",w=100,[ne,_e]=Z(S),[ie,ce]=ne(S),A=v.forwardRef((s,t)=>{const{__scopeProgress:r,value:i=null,max:n,getValueLabel:u=le,...m}=s;(n||n===0)&&!R(n)&&console.error(oe(`${n}`,"Progress"));const d=R(n)?n:w;i!==null&&!$(i,d)&&console.error(de(`${i}`,"Progress"));const a=$(i,d)?i:null,o=j(a)?u(a,d):void 0;return e.jsx(ie,{scope:r,value:a,max:d,children:e.jsx(L.div,{"aria-valuemax":d,"aria-valuemin":0,"aria-valuenow":j(a)?a:void 0,"aria-valuetext":o,role:"progressbar","data-state":Q(a,d),"data-value":a??void 0,"data-max":d,...m,ref:t})})});A.displayName=S;var F="ProgressIndicator",K=v.forwardRef((s,t)=>{const{__scopeProgress:r,...i}=s,n=ce(F,r);return e.jsx(L.div,{"data-state":Q(n.value,n.max),"data-value":n.value??void 0,"data-max":n.max,...i,ref:t})});K.displayName=F;function le(s,t){return`${Math.round(s/t*100)}%`}function Q(s,t){return s==null?"indeterminate":s===t?"complete":"loading"}function j(s){return typeof s=="number"}function R(s){return j(s)&&!isNaN(s)&&s>0}function $(s,t){return j(s)&&!isNaN(s)&&s<=t&&s>=0}function oe(s,t){return`Invalid prop \`max\` of value \`${s}\` supplied to \`${t}\`. Only numbers greater than 0 are valid max values. Defaulting to \`${w}\`.`}function de(s,t){return`Invalid prop \`value\` of value \`${s}\` supplied to \`${t}\`. The \`value\` prop must be:
  - a positive number
  - less than the value passed to \`max\` (or ${w} if no \`max\` prop is set)
  - \`null\` or \`undefined\` if the progress is indeterminate.

Defaulting to \`null\`.`}var ue=A,me=K;function O({className:s,value:t,...r}){return e.jsx(ue,{"data-slot":"progress",className:g("bg-primary/20 relative h-2 w-full overflow-hidden rounded-full",s),...r,children:e.jsx(me,{"data-slot":"progress-indicator",className:"bg-primary h-full w-full flex-1 transition-all",style:{transform:`translateX(-${100-(t||0)}%)`}})})}const he=X("src_server_functions_streamSimpleProgress_ts--_streamSimpleProgress_createServerFn_handler","/_serverFn"),xe=H({method:"POST",response:"raw"}).handler(he);function fe(s,t){return{async*[Symbol.asyncIterator](){const r=await xe({data:s,signal:t});if(!r.body)return;const i=r.body.pipeThrough(new TextDecoderStream);let n="";const u=new TransformStream({transform(a,o){n+=a;let c;for(;(c=n.indexOf(`
`))!==-1;){const l=n.slice(0,c).trim();n=n.slice(c+1),l&&o.enqueue(l)}},flush(a){const o=n.trim();o&&a.enqueue(o)}}),m=i.pipeThrough(u);async function*d(a){const o=a.getReader();try{for(;;){const{value:c,done:l}=await o.read();if(l)break;yield c}}finally{o.releaseLock()}}for await(const a of d(m))try{yield JSON.parse(a)}catch{}}}}const pe=s=>ee({queryKey:["summoner-progress",s.puuid,s.region,s.queue],queryFn:se({queryFn:({signal:t})=>{try{return fe(s,t)}catch(r){throw console.error(r),r}},refetchMode:"reset"}),staleTime:1/0,gcTime:0,retry:!1}),p=["fetching_summoner","fetching_matches","fetching_leagues","fetching_stats"],ge={fetching_summoner:"pending",fetching_matches:"pending",fetching_leagues:"pending",fetching_stats:"pending"};function ve(s){let t="idle",r={...ge},i=null,n=null,u=0;for(const c of s){if(c.status==="started"){t="started";continue}if(c.status==="finished"){t="finished";continue}const l=c.step;if(l){if(c.status==="step_started"){for(const x of p){if(x===l)break;r[x]!=="done"&&(r[x]="done")}r[l]="active",i=l;continue}if(c.status==="step_in_progress"){r[l]==="pending"&&(r[l]="active"),i=l,l==="fetching_matches"&&("matchesToFetch"in c&&(n=c.matchesToFetch),"matchesFetched"in c&&(u+=c.matchesFetched));continue}if(c.status==="step_finished"){r[l]="done",i===l&&(i=null);continue}}}if(t==="finished"){for(const c of p)r[c]="done";i=null}const m=100/p.length,d=p.filter(c=>r[c]==="done").length*m,a=i==="fetching_matches"&&n&&n>0?Math.min(1,u/n)*m:0,o=Math.min(100,Math.round(d+a));return{status:t,stepStatus:r,currentStep:i,totalMatches:n,fetchedMatches:u,overallPercent:o}}const T=s=>s==="fetching_summoner"?"Profil invocateur":s==="fetching_matches"?"Matchs":s==="fetching_leagues"?"Ligues":"Statistiques";function ze(){const[s,t]=v.useState(!1),{summoner:r,queueStats:i}=J({from:"/lol/summoner/$riotID"}),{queue:n}={queue:"RANKED_SOLO_5x5"},u=U(),m=W({...pe({puuid:r.puuid,region:r.region,queue:n}),refetchOnWindowFocus:!1,enabled:s}),d=m.data??[],{status:a,stepStatus:o,currentStep:c,totalMatches:l,fetchedMatches:x,overallPercent:P}=v.useMemo(()=>ve(d),[d]),V=a==="finished"?"bg-emerald-900 text-emerald-200":(m.fetchStatus==="fetching"||a==="started","bg-zinc-800 text-zinc-200"),B=h=>{const q=o[h];return q==="done"?e.jsx(k,{className:"h-4 w-4 text-emerald-400"}):q==="active"?e.jsx(M,{className:"h-4 w-4 animate-spin text-zinc-200"}):e.jsx(ae,{className:"h-4 w-4 text-zinc-600"})},I=()=>{u.removeQueries({queryKey:["summoner-progress",r.puuid,r.region,n]}),D.info(`Mise à jour annulée pour ${r.riotId}`)},G=()=>{u.removeQueries({queryKey:["summoner-progress",r.puuid,r.region,n]}),a==="finished"&&D.success(`Profil ${r.riotId} synchronisé`)};return e.jsxs("div",{className:"relative bg-zinc-950 text-zinc-100 flex-1",children:[e.jsx(f,{onClick:()=>t(!0),children:"Refresh :)"}),e.jsxs("div",{"aria-hidden":!0,className:"pointer-events-none absolute inset-0 overflow-hidden",children:[e.jsx("div",{className:"absolute -top-24 -left-24 h-72 w-72 rounded-full bg-emerald-500/10 blur-3xl"}),e.jsx("div",{className:"absolute -bottom-24 -right-24 h-72 w-72 rounded-full bg-indigo-500/10 blur-3xl"})]}),e.jsx("header",{className:"sticky top-0 z-10 border-b border-zinc-900/60 backdrop-blur supports-[backdrop-filter]:bg-zinc-950/70",children:e.jsxs("div",{className:"mx-auto flex max-w-5xl items-center justify-between px-4 py-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[m.fetchStatus==="fetching"&&a!=="finished"?e.jsx(M,{className:"h-5 w-5 animate-spin"}):null,e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg font-semibold tracking-tight",children:"Mise à jour du profil"}),e.jsx("p",{className:"text-xs text-zinc-400",children:"Synchronisation des données, restez sur la page"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Y,{variant:"secondary",className:V,children:a==="idle"?"pending":a}),a==="finished"?e.jsx(f,{size:"sm",variant:"secondary",asChild:!0,children:e.jsx(b,{to:"/lol/summoner/$riotID",params:{riotID:r.riotId.replace(/#/g,"-")},search:{queue:"RANKED_SOLO_5x5"},children:"Retour au profil"})}):e.jsx(f,{size:"sm",variant:"ghost",onClick:I,children:"Annuler"})]})]})}),e.jsxs("main",{className:"mx-auto grid w-full max-w-5xl grid-cols-1 gap-6 px-4 py-8 md:grid-cols-5",children:[e.jsxs("section",{className:"md:col-span-3",children:[e.jsxs(N,{className:"border-zinc-800 bg-zinc-900/40",children:[e.jsx(y,{children:e.jsxs(_,{className:"flex items-center justify-between gap-2",children:[e.jsx("span",{children:"Progression globale"}),e.jsxs("span",{className:"text-sm tabular-nums text-zinc-400",children:[P,"%"]})]})}),e.jsxs(z,{className:"space-y-4",children:[e.jsx(O,{value:P,className:"h-2 bg-zinc-900"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{className:"rounded-xl border border-zinc-800 bg-zinc-900/30 p-3",children:[e.jsx("div",{className:"text-zinc-400",children:"Étape en cours"}),e.jsx("div",{className:"mt-1 font-medium",children:c?T(c):a==="finished"?"Terminé":a==="started"?"En cours":"En attente"})]}),e.jsxs("div",{className:"rounded-xl border border-zinc-800 bg-zinc-900/30 p-3",children:[e.jsx("div",{className:"text-zinc-400",children:"Statut"}),e.jsx("div",{className:"mt-1 font-medium",children:a==="idle"?"pending":a})]})]})]})]}),e.jsxs(N,{className:"mt-6 border-zinc-800 bg-zinc-900/40",children:[e.jsx(y,{children:e.jsx(_,{children:"Étapes"})}),e.jsx(z,{children:e.jsx("ol",{className:"space-y-3",children:p.map(h=>e.jsxs("li",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[B(h),e.jsx("span",{className:o[h]==="done"?"text-emerald-200":o[h]==="active"?"text-zinc-100":"text-zinc-500",children:T(h)})]}),h==="fetching_matches"&&l!==null?e.jsxs("span",{className:"text-xs tabular-nums text-zinc-400",children:[Math.min(100,Math.round(x/Math.max(1,l)*100)),"%"]}):e.jsx("span",{className:"text-xs text-zinc-400",children:o[h]==="done"?"terminé":o[h]==="active"?"en cours":"en attente"})]},h))})})]})]}),e.jsx("aside",{className:"md:col-span-2",children:e.jsxs(N,{className:"border-zinc-800 bg-zinc-900/40",children:[e.jsx(y,{children:e.jsx(_,{children:"Invocateur"})}),e.jsxs(z,{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-zinc-400",children:"Riot ID"}),e.jsx("span",{className:"font-medium",children:r.riotId})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-zinc-400",children:"Région"}),e.jsx("span",{className:"font-medium",children:r.region})]}),c==="fetching_matches"&&l!==null?e.jsxs("div",{className:"rounded-xl border border-zinc-800 bg-zinc-900/30 p-3",children:[e.jsx("div",{className:"text-sm text-zinc-400",children:"Téléchargement des matchs"}),e.jsxs("div",{className:"mt-1 text-sm tabular-nums",children:[x,"/",l]}),e.jsx(O,{value:Math.min(100,Math.round(x/Math.max(1,l)*100)),className:"mt-2 h-1.5 bg-zinc-900"})]}):null,a==="finished"?e.jsxs("div",{className:"rounded-xl border border-emerald-800 bg-emerald-950/40 p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-emerald-200",children:[e.jsx(k,{className:"h-4 w-4"}),e.jsx("span",{children:"Synchronisation terminée"})]}),e.jsx("div",{className:"mt-2",children:e.jsx(f,{className:"w-full",variant:"secondary",asChild:!0,children:e.jsx(b,{to:"/lol/summoner/$riotID",params:{riotID:r.riotId.replace(/#/g,"-")},search:{queue:"RANKED_SOLO_5x5"},onClick:G,children:"Voir le profil"})})})]}):e.jsxs("div",{className:"rounded-xl border border-zinc-800 bg-zinc-900/30 p-3",children:[e.jsx("div",{className:"text-sm text-zinc-400",children:"Besoin d’interrompre"}),e.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[e.jsx(f,{variant:"ghost",onClick:I,children:"Annuler"}),e.jsx(f,{variant:"secondary",asChild:!0,children:e.jsx(b,{to:"/lol/summoner/$riotID",params:{riotID:r.riotId.replace(/#/g,"-")},search:{queue:"RANKED_SOLO_5x5"},children:"Retour"})})]})]})]})]})})]})]})}export{ze as component};
