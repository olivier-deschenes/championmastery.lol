import{x as q,c as A,r as h,j as e,y as G,b,m as H,n as X,h as J,z as U,A as W,B as g,L as _,C as D}from"./main-Cmqr_NjK.js";import{u as Y}from"./useQuery-CPOzgXzX.js";import{B as Z}from"./badge-DAzccFxR.js";import{q as ee}from"./queryOptions-C9woPjwX.js";import{L as k}from"./loader-circle-B2hfbd1y.js";function se({queryFn:s,refetchMode:t="reset",maxChunks:r}){return async n=>{const a=n.client.getQueryCache().find({queryKey:n.queryKey,exact:!0}),m=!!a&&a.state.data!==void 0;m&&t==="reset"&&a.setState({status:"pending",data:void 0,error:null,fetchStatus:"fetching"});let l=[];const i=await s(n);for await(const c of i){if(n.signal.aborted)break;(!m||t!=="replace")&&n.client.setQueryData(n.queryKey,(d=[])=>q(d,c,r)),l=q(l,c,r)}return m&&t==="replace"&&!n.signal.aborted&&n.client.setQueryData(n.queryKey,l),n.client.getQueryData(n.queryKey)}}/**
 * @license lucide-react v0.540.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],R=A("circle-check",te);/**
 * @license lucide-react v0.540.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],ne=A("circle",re);var ae=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],F=ae.reduce((s,t)=>{const r=G(`Primitive.${t}`),n=h.forwardRef((a,m)=>{const{asChild:l,...i}=a,c=l?r:t;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),e.jsx(c,{...i,ref:m})});return n.displayName=`Primitive.${t}`,{...s,[t]:n}},{});function w({className:s,...t}){return e.jsx("div",{"data-slot":"card",className:b("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",s),...t})}function z({className:s,...t}){return e.jsx("div",{"data-slot":"card-header",className:b("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",s),...t})}function P({className:s,...t}){return e.jsx("div",{"data-slot":"card-title",className:b("leading-none font-semibold",s),...t})}function C({className:s,...t}){return e.jsx("div",{"data-slot":"card-content",className:b("px-6",s),...t})}function ie(s,t=[]){let r=[];function n(m,l){const i=h.createContext(l),c=r.length;r=[...r,l];const d=u=>{const{scope:p,children:v,...f}=u,N=p?.[s]?.[c]||i,S=h.useMemo(()=>f,Object.values(f));return e.jsx(N.Provider,{value:S,children:v})};d.displayName=m+"Provider";function o(u,p){const v=p?.[s]?.[c]||i,f=h.useContext(v);if(f)return f;if(l!==void 0)return l;throw new Error(`\`${u}\` must be used within \`${m}\``)}return[d,o]}const a=()=>{const m=r.map(l=>h.createContext(l));return function(i){const c=i?.[s]||m;return h.useMemo(()=>({[`__scope${s}`]:{...i,[s]:c}}),[i,c])}};return a.scopeName=s,[n,ce(a,...t)]}function ce(...s){const t=s[0];if(s.length===1)return t;const r=()=>{const n=s.map(a=>({useScope:a(),scopeName:a.scopeName}));return function(m){const l=n.reduce((i,{useScope:c,scopeName:d})=>{const u=c(m)[`__scope${d}`];return{...i,...u}},{});return h.useMemo(()=>({[`__scope${t.scopeName}`]:l}),[l])}};return r.scopeName=t.scopeName,r}var I="Progress",$=100,[oe,Pe]=ie(I),[le,de]=oe(I),K=h.forwardRef((s,t)=>{const{__scopeProgress:r,value:n=null,max:a,getValueLabel:m=ue,...l}=s;(a||a===0)&&!O(a)&&console.error(me(`${a}`,"Progress"));const i=O(a)?a:$;n!==null&&!E(n,i)&&console.error(he(`${n}`,"Progress"));const c=E(n,i)?n:null,d=y(c)?m(c,i):void 0;return e.jsx(le,{scope:r,value:c,max:i,children:e.jsx(F.div,{"aria-valuemax":i,"aria-valuemin":0,"aria-valuenow":y(c)?c:void 0,"aria-valuetext":d,role:"progressbar","data-state":V(c,i),"data-value":c??void 0,"data-max":i,...l,ref:t})})});K.displayName=I;var Q="ProgressIndicator",B=h.forwardRef((s,t)=>{const{__scopeProgress:r,...n}=s,a=de(Q,r);return e.jsx(F.div,{"data-state":V(a.value,a.max),"data-value":a.value??void 0,"data-max":a.max,...n,ref:t})});B.displayName=Q;function ue(s,t){return`${Math.round(s/t*100)}%`}function V(s,t){return s==null?"indeterminate":s===t?"complete":"loading"}function y(s){return typeof s=="number"}function O(s){return y(s)&&!isNaN(s)&&s>0}function E(s,t){return y(s)&&!isNaN(s)&&s<=t&&s>=0}function me(s,t){return`Invalid prop \`max\` of value \`${s}\` supplied to \`${t}\`. Only numbers greater than 0 are valid max values. Defaulting to \`${$}\`.`}function he(s,t){return`Invalid prop \`value\` of value \`${s}\` supplied to \`${t}\`. The \`value\` prop must be:
  - a positive number
  - less than the value passed to \`max\` (or ${$} if no \`max\` prop is set)
  - \`null\` or \`undefined\` if the progress is indeterminate.

Defaulting to \`null\`.`}var pe=K,xe=B;function T({className:s,value:t,...r}){return e.jsx(pe,{"data-slot":"progress",className:b("bg-primary/20 relative h-2 w-full overflow-hidden rounded-full",s),...r,children:e.jsx(xe,{"data-slot":"progress-indicator",className:"bg-primary h-full w-full flex-1 transition-all",style:{transform:`translateX(-${100-(t||0)}%)`}})})}const fe=H("src_server_functions_streamSimpleProgress_ts--_streamSimpleProgress_createServerFn_handler","/_serverFn"),ge=X({method:"POST",response:"raw"}).handler(fe);function ve(s,t){return{async*[Symbol.asyncIterator](){const r=await ge({data:s,signal:t});if(!r.body)return;const n=r.body.pipeThrough(new TextDecoderStream);let a="";const m=new TransformStream({transform(c,d){a+=c;let o;for(;(o=a.indexOf(`
`))!==-1;){const u=a.slice(0,o).trim();a=a.slice(o+1),u&&d.enqueue(u)}},flush(c){const d=a.trim();d&&c.enqueue(d)}}),l=n.pipeThrough(m);async function*i(c){const d=c.getReader();try{for(;;){const{value:o,done:u}=await d.read();if(u)break;yield o}}finally{d.releaseLock()}}for await(const c of i(l))try{const d=JSON.parse(c);console.log(d),yield d}catch{}}}}const je=s=>ee({queryKey:["summoner-progress",s.puuid,s.region,s.queue],queryFn:se({queryFn:({signal:t})=>{try{return ve(s,t)}catch(r){throw console.error(r),r}},refetchMode:"reset"}),staleTime:1/0,gcTime:0,retry:!1}),j=["fetching_summoner","fetching_matches","fetching_leagues","fetching_stats"],be={fetching_summoner:"pending",fetching_matches:"pending",fetching_leagues:"pending",fetching_stats:"pending"};function Ne(s){let t="idle",r={...be},n=null,a=null,m=0;for(const o of s){if(o.status==="started"){t="started";continue}if(o.status==="finished"){t="finished";continue}const u=o.step;if(u){if(o.status==="step_started"){for(const p of j){if(p===u)break;r[p]!=="done"&&(r[p]="done")}r[u]="active",n=u;continue}if(o.status==="step_in_progress"){r[u]==="pending"&&(r[u]="active"),n=u,u==="fetching_matches"&&("matchesToFetch"in o&&(a=o.matchesToFetch),"matchesFetched"in o&&(m+=o.matchesFetched));continue}if(o.status==="step_finished"){r[u]="done",n===u&&(n=null);continue}}}if(t==="finished"){for(const o of j)r[o]="done";n=null}const l=100/j.length,i=j.filter(o=>r[o]==="done").length*l,c=n==="fetching_matches"&&a&&a>0?Math.min(1,m/a)*l:0,d=Math.min(100,Math.round(i+c));return{status:t,stepStatus:r,currentStep:n,totalMatches:a,fetchedMatches:m,overallPercent:d}}const L=s=>s==="fetching_summoner"?"Profil invocateur":s==="fetching_matches"?"Matchs":s==="fetching_leagues"?"Ligues":"Statistiques";function Ce(){const[s,t]=h.useState(!1),{summoner:r}=J({from:"/lol/summoner/$riotID"}),{queue:n}=U({from:"/lol/summoner/$riotID"}),a=W(),m=Y({...je({puuid:r.puuid,region:r.region,queue:n}),refetchOnWindowFocus:!1,enabled:s}),l=m.data??[],{status:i,stepStatus:c,currentStep:d,totalMatches:o,fetchedMatches:u,overallPercent:p}=h.useMemo(()=>Ne(l),[l]),v=i==="finished"?"bg-emerald-900 text-emerald-200":(m.fetchStatus==="fetching"||i==="started","bg-zinc-800 text-zinc-200"),f=x=>{const M=c[x];return M==="done"?e.jsx(R,{className:"h-4 w-4 text-emerald-400"}):M==="active"?e.jsx(k,{className:"h-4 w-4 animate-spin text-zinc-200"}):e.jsx(ne,{className:"h-4 w-4 text-zinc-600"})},N=()=>{a.removeQueries({queryKey:["summoner-progress",r.puuid,r.region,n]}),D.info(`Mise à jour annulée pour ${r.riotId}`)},S=()=>{a.removeQueries({queryKey:["summoner-progress",r.puuid,r.region,n]}),i==="finished"&&D.success(`Profil ${r.riotId} synchronisé`)};return e.jsxs("div",{className:"relative min-h-screen bg-zinc-950 text-zinc-100",children:[e.jsx(g,{onClick:()=>t(!0),children:"Refresh :)"}),e.jsxs("div",{"aria-hidden":!0,className:"pointer-events-none absolute inset-0 overflow-hidden",children:[e.jsx("div",{className:"absolute -top-24 -left-24 h-72 w-72 rounded-full bg-emerald-500/10 blur-3xl"}),e.jsx("div",{className:"absolute -bottom-24 -right-24 h-72 w-72 rounded-full bg-indigo-500/10 blur-3xl"})]}),e.jsx("header",{className:"sticky top-0 z-10 border-b border-zinc-900/60 backdrop-blur supports-[backdrop-filter]:bg-zinc-950/70",children:e.jsxs("div",{className:"mx-auto flex max-w-5xl items-center justify-between px-4 py-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[m.fetchStatus==="fetching"&&i!=="finished"?e.jsx(k,{className:"h-5 w-5 animate-spin"}):null,e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg font-semibold tracking-tight",children:"Mise à jour du profil"}),e.jsx("p",{className:"text-xs text-zinc-400",children:"Synchronisation des données, restez sur la page"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Z,{variant:"secondary",className:v,children:i==="idle"?"pending":i}),i==="finished"?e.jsx(g,{size:"sm",variant:"secondary",asChild:!0,children:e.jsx(_,{to:"/lol/summoner/$riotID",params:{riotID:r.riotId.replace(/#/g,"-")},search:{queue:"RANKED_SOLO_5x5"},children:"Retour au profil"})}):e.jsx(g,{size:"sm",variant:"ghost",onClick:N,children:"Annuler"})]})]})}),e.jsxs("main",{className:"mx-auto grid w-full max-w-5xl grid-cols-1 gap-6 px-4 py-8 md:grid-cols-5",children:[e.jsxs("section",{className:"md:col-span-3",children:[e.jsxs(w,{className:"border-zinc-800 bg-zinc-900/40",children:[e.jsx(z,{children:e.jsxs(P,{className:"flex items-center justify-between gap-2",children:[e.jsx("span",{children:"Progression globale"}),e.jsxs("span",{className:"text-sm tabular-nums text-zinc-400",children:[p,"%"]})]})}),e.jsxs(C,{className:"space-y-4",children:[e.jsx(T,{value:p,className:"h-2 bg-zinc-900"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{className:"rounded-xl border border-zinc-800 bg-zinc-900/30 p-3",children:[e.jsx("div",{className:"text-zinc-400",children:"Étape en cours"}),e.jsx("div",{className:"mt-1 font-medium",children:d?L(d):i==="finished"?"Terminé":i==="started"?"En cours":"En attente"})]}),e.jsxs("div",{className:"rounded-xl border border-zinc-800 bg-zinc-900/30 p-3",children:[e.jsx("div",{className:"text-zinc-400",children:"Statut"}),e.jsx("div",{className:"mt-1 font-medium",children:i==="idle"?"pending":i})]})]})]})]}),e.jsxs(w,{className:"mt-6 border-zinc-800 bg-zinc-900/40",children:[e.jsx(z,{children:e.jsx(P,{children:"Étapes"})}),e.jsx(C,{children:e.jsx("ol",{className:"space-y-3",children:j.map(x=>e.jsxs("li",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[f(x),e.jsx("span",{className:c[x]==="done"?"text-emerald-200":c[x]==="active"?"text-zinc-100":"text-zinc-500",children:L(x)})]}),x==="fetching_matches"&&o!==null?e.jsxs("span",{className:"text-xs tabular-nums text-zinc-400",children:[Math.min(100,Math.round(u/Math.max(1,o)*100)),"%"]}):e.jsx("span",{className:"text-xs text-zinc-400",children:c[x]==="done"?"terminé":c[x]==="active"?"en cours":"en attente"})]},x))})})]})]}),e.jsx("aside",{className:"md:col-span-2",children:e.jsxs(w,{className:"border-zinc-800 bg-zinc-900/40",children:[e.jsx(z,{children:e.jsx(P,{children:"Invocateur"})}),e.jsxs(C,{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-zinc-400",children:"Riot ID"}),e.jsx("span",{className:"font-medium",children:r.riotId})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-zinc-400",children:"Région"}),e.jsx("span",{className:"font-medium",children:r.region})]}),d==="fetching_matches"&&o!==null?e.jsxs("div",{className:"rounded-xl border border-zinc-800 bg-zinc-900/30 p-3",children:[e.jsx("div",{className:"text-sm text-zinc-400",children:"Téléchargement des matchs"}),e.jsxs("div",{className:"mt-1 text-sm tabular-nums",children:[u,"/",o]}),e.jsx(T,{value:Math.min(100,Math.round(u/Math.max(1,o)*100)),className:"mt-2 h-1.5 bg-zinc-900"})]}):null,i==="finished"?e.jsxs("div",{className:"rounded-xl border border-emerald-800 bg-emerald-950/40 p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-emerald-200",children:[e.jsx(R,{className:"h-4 w-4"}),e.jsx("span",{children:"Synchronisation terminée"})]}),e.jsx("div",{className:"mt-2",children:e.jsx(g,{className:"w-full",variant:"secondary",asChild:!0,children:e.jsx(_,{to:"/lol/summoner/$riotID",params:{riotID:r.riotId.replace(/#/g,"-")},search:{queue:"RANKED_SOLO_5x5"},onClick:S,children:"Voir le profil"})})})]}):e.jsxs("div",{className:"rounded-xl border border-zinc-800 bg-zinc-900/30 p-3",children:[e.jsx("div",{className:"text-sm text-zinc-400",children:"Besoin d’interrompre"}),e.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[e.jsx(g,{variant:"ghost",onClick:N,children:"Annuler"}),e.jsx(g,{variant:"secondary",asChild:!0,children:e.jsx(_,{to:"/lol/summoner/$riotID",params:{riotID:r.riotId.replace(/#/g,"-")},search:{queue:"RANKED_SOLO_5x5"},children:"Retour"})})]})]})]})]})})]})]})}export{Ce as component};
